<div class="dashboard-container">
  <header class="header" style="display: flex; align-items: center; justify-content: space-between;">
    <div>
      <h1>Client Management Dashboard</h1>
      <p>Manage your bank details, employees, and beneficiaries</p>
    </div>
    <div>
      <button style="padding: 5px 10px; border-radius: 10px; background-color: rgb(239, 67, 67); color: white;" (click)="logout()">Logout</button>
    </div>
  </header>
  
  <div class="tabs">
    <button 
      class="tab-btn" 
      [class.active]="activeTab === 'bank'"
      (click)="setActiveTab('bank')">
      Bank Details
    </button>
    <button 
      class="tab-btn" 
      [class.active]="activeTab === 'employees'"
      (click)="setActiveTab('employees')">
      Employees
    </button>
    <button 
      class="tab-btn" 
      [class.active]="activeTab === 'beneficiaries'"
      (click)="setActiveTab('beneficiaries')">
      Beneficiaries
    </button>
    <button 
      class="tab-btn" 
      [class.active]="activeTab === 'payments'"
      (click)="setActiveTab('payments')">
      Payments
    </button>
    <button 
      class="tab-btn" 
      [class.active]="activeTab === 'reports'"
      (click)="setActiveTab('reports')">
      Reports
    </button>
  </div>
  
  <!-- Bank Details Tab -->
  <div class="tab-content" *ngIf="activeTab === 'bank'">
    <div class="bank-details-card">
      <h2>Account Information</h2>
      <div class="details-grid">
        <div class="detail-item">
          <label>Account Holder</label>
          <p>{{ bankDetails.accountHolder }}</p>
        </div>
        <div class="detail-item">
          <label>Account Number</label>
          <p>{{ bankDetails.accountNumber }}</p>
        </div>
        <div class="detail-item">
          <label>Bank Name</label>
          <p>{{ bankDetails.bankName }}</p>
        </div>
        <div class="detail-item">
          <label>IFSC Code</label>
          <p>{{ bankDetails.ifscCode }}</p>
        </div>
        <div class="detail-item">
          <label>Branch</label>
          <p>{{ bankDetails.branch }}</p>
        </div>
        <div class="detail-item">
          <label>Account Type</label>
          <p>{{ bankDetails.accountType }}</p>
        </div>
        <div class="detail-item balance">
          <label>Current Balance</label>
          <p class="balance-amount">₹{{ bankDetails.balance | number:'1.2-2' }}</p>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Employees Tab -->
  <div class="tab-content" *ngIf="activeTab === 'employees'">
    <div class="toolbar">
      <input 
        type="text" 
        class="search-input" 
        placeholder="Search employees by name, email, or department..."
        [(ngModel)]="searchTerm">
      <button class="btn-primary" (click)="openAddEmployeeModal()">
        + Add Employee
      </button>
      <input type="file" (change)="onFileSelected($event)" accept=".csv" />
      <button (click)="uploadCsv()">Upload CSV</button>
    </div>
    
    <div class="table-container">
      <table class="data-table">
        <thead>
          <tr>
            <th>Name</th>
            <th>Email</th>
            <th>Position</th>
            <th>Department</th>
            <th>Salary</th>
            <th>Join Date</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let employee of filteredEmployees">
            <td>{{ employee.name }}</td>
            <td>{{ employee.email }}</td>
            <td>{{ employee.position }}</td>
            <td>{{ employee.department }}</td>
            <td>₹{{ employee.salary | number }}</td>
            <td>{{ employee.joinDate }}</td>
            <td>
              <button class="btn-edit" (click)="openEditEmployeeModal(employee)">Edit</button>
              <button class="btn-delete" (click)="deleteEmployee(employee.employeeId)">Delete</button>
              <button class="btn-add-salary" (click)="salaryDisburment(employee.employeeId)"> Salary </button>
            </td>
          </tr>
          <tr *ngIf="filteredEmployees.length === 0">
            <td colspan="7" class="no-data">No employees found</td>
          </tr>
        </tbody>
      </table>
    </div>
    <!-- Employee Pagination -->
    <div class="pagination" *ngIf="filteredEmployees.length > 0">
      <div class="pagination-info">
        Showing {{ (employeePage - 1) * employeePageSize + 1 }} to 
        {{ getMinEmployee() }} 
        of {{ filteredEmployees.length }} employees
      </div>
      <div class="pagination-controls">
        <button class="page-btn" (click)="previousEmployeePage()" [disabled]="employeePage === 1">
          Previous
        </button>
        <button 
          *ngFor="let page of employeePageNumbers" 
          class="page-btn" 
          [class.active]="page === employeePage"
          (click)="changeEmployeePage(page)">
          {{ page }}
        </button>
        <button class="page-btn" (click)="nextEmployeePage()" [disabled]="employeePage === totalEmployeePages">
          Next
        </button>
      </div>
    </div>
  </div>
  
  <!-- Beneficiaries Tab -->
  <div class="tab-content" *ngIf="activeTab === 'beneficiaries'">
    <div class="toolbar">
      <input 
        type="text" 
        class="search-input" 
        placeholder="Search beneficiaries by name, bank, or account number..."
        [(ngModel)]="searchTerm">
      <button class="btn-primary" (click)="openAddBeneficiaryModal()">
        + Add Beneficiary
      </button>
    </div>
    
    <div class="table-container">
      <table class="data-table">
        <thead>
          <tr>
            <th>Name</th>
            <th>Account Number</th>
            <th>IFSC Code</th>
            <th>Bank Name</th>
            <th>Relationship</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let beneficiary of filteredBeneficiaries">
            <td>{{ beneficiary.name }}</td>
            <td>{{ beneficiary.accountNumber }}</td>
            <td>{{ beneficiary.ifscCode }}</td>
            <td>{{ beneficiary.bankName }}</td>
            <td>{{ beneficiary.relationShip }}</td>
            <td>
              <button class="btn-edit" (click)="openEditBeneficiaryModal(beneficiary)">Edit</button>
              <button class="btn-delete" (click)="deleteBeneficiary(beneficiary.beneficiaryId)">Delete</button>
            </td>
          </tr>
          <tr *ngIf="filteredBeneficiaries.length === 0">
            <td colspan="6" class="no-data">No beneficiaries found</td>
          </tr>
        </tbody>
      </table>
    </div>
    <!-- Beneficiary Pagination -->
    <div class="pagination" *ngIf="filteredEmployees.length > 0">
      <div class="pagination-info">
        Showing {{ (beneficiaryPage - 1) * beneficiaryPageSize + 1 }} to 
        {{ getMinBeneficiary() }} 
        of {{ filteredBeneficiaries.length }} beneficiaries
      </div>
      <div class="pagination-controls">
        <button class="page-btn" (click)="previousBeneficiaryPage()" [disabled]="beneficiaryPage === 1">
          Previous
        </button>
        <button 
          *ngFor="let page of beneficiaryPageNumbers" 
          class="page-btn" 
          [class.active]="page === beneficiaryPage"
          (click)="changeBeneficiaryPage(page)">
          {{ page }}
        </button>
        <button class="page-btn" (click)="nextBeneficiaryPage()" [disabled]="beneficiaryPage === totalBeneficiaryPages">
          Next
        </button>
      </div>
    </div>
  </div>
  
  <!-- Payments Tab -->
  <div class="tab-content" *ngIf="activeTab === 'payments'">
    <div class="toolbar">
      <input 
        type="text" 
        class="search-input" 
        placeholder="Search payments by beneficiary, transaction ID, or status..."
        [(ngModel)]="searchTerm">
      <button class="btn-primary" (click)="openMakePaymentModal()">
        + Make Payment
      </button>
    </div>
    
    <div class="table-container">
      <table class="data-table">
        <thead>
          <tr>
            <th>Payment ID</th>
            <th>Beneficiary</th>
            <th>Amount</th>
            <th>Date</th>
            <th>Status</th>
            <th>Remarks</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let payment of filteredPayments">
            <td><strong>{{ payment.paymentId }}</strong></td>
            <td>{{ payment.beneficiary?.name }}</td>
            <td class="amount-cell">₹{{ payment.amount | number:'1.2-2' }}</td>
            <td>{{ payment.paymentDate | date:'dd/MM/yyyy' }}</td>
            <td>
              <span [class]="'status-badge ' + getStatusClass(payment.status)">
                {{ payment.status == "0" ?"Pending":(payment.status == "1" ? "Appoved" : "Rejected") }}
              </span>
            </td>
            <td>{{ payment.remarks }}</td>
          </tr>
          <tr *ngIf="filteredPayments.length === 0">
            <td colspan="6" class="no-data">No payments found</td>
          </tr>
        </tbody>
      </table>
    </div>
    <!-- Payment Pagination -->
    <div class="pagination" *ngIf="filteredEmployees.length > 0">
      <div class="pagination-info">
        Showing {{ (paymentPage - 1) * paymentPageSize + 1 }} to 
        {{ getMinPayment() }} 
        of {{ filteredPayments.length }} payments
      </div>
      <div class="pagination-controls">
        <button class="page-btn" (click)="previousPaymentPage()" [disabled]="paymentPage === 1">
          Previous
        </button>
        <button 
          *ngFor="let page of paymentPageNumbers" 
          class="page-btn" 
          [class.active]="page === paymentPage" 
          (click)="changePaymentPage(page)">
          {{ page }}
        </button>
        <button class="page-btn" (click)="nextPaymentPage()" [disabled]="paymentPage === totalPaymentPages">
          Next
        </button>
      </div>
    </div>
  </div>


  <!-- Report Tab -->
  <div class="tab-content" *ngIf="activeTab === 'reports'">
    <form>
      <input type="date" [(ngModel)]="reportFromDate" class="date-control" name="Start date" placeholder="Start date" />
      <span> TO </span>
      <input type="date" [(ngModel)]="reportToDate" class="date-control" name="Start date" placeholder="Start date" />
    </form>
    <button (click)="generatePaymentReport()" style="margin: 10px; padding: 10px; border-radius: 10px; color: white; background-color: green;" > Salary Disbursment </button>
  </div>
  
  <!-- Employee Modal -->
  <div class="modal-overlay-css" *ngIf="showEmployeeModal" (click)="closeEmployeeModal()">
    <div class="modal-css" (click)="$event.stopPropagation()">
      <div class="modal-header-css">
        <h2>{{ isEditMode ? 'Edit Employee' : 'Add New Employee' }}</h2>
        <button class="close-btn" (click)="closeEmployeeModal()">×</button>
      </div>
      <div class="modal-body-css">
        <form>
          <div class="form-group">
            <label>Name *</label>
            <input 
              type="text" 
              class="form-control"
              [(ngModel)]="currentEmployee.name" 
              name="employeeName"
              placeholder="Enter employee name"
              required>
          </div>
          <div class="form-group">
            <label>Email *</label>
            <input 
              type="email" 
              class="form-control"
              [(ngModel)]="currentEmployee.email" 
              name="employeeEmail"
              placeholder="Enter email address"
              required>
          </div>
          <div class="form-group">
            <label>Address *</label>
            <input 
              type="email" 
              class="form-control"
              [(ngModel)]="currentEmployee.address" 
              name="employeeAddress"
              placeholder="Enter address"
              required>
          </div>
          <div class="form-group">
            <label>Position *</label>
            <input 
              type="text" 
              class="form-control"
              [(ngModel)]="currentEmployee.position" 
              name="employeePosition"
              placeholder="Enter position"
              required>
          </div>
          <div class="form-group">
            <label>Department *</label>
            <input 
              type="text" 
              class="form-control"
              [(ngModel)]="currentEmployee.department" 
              name="employeeDepartment"
              placeholder="Enter department"
              required>
          </div>
          <div class="form-group">
            <label>Salary *</label>
            <input 
              type="number" 
              class="form-control"
              [(ngModel)]="currentEmployee.salary" 
              name="employeeSalary"
              placeholder="Enter salary"
              min="0"
              required>
          </div>
          <div class="form-group">
            <label>Join Date *</label>
            <input 
              type="date" 
              class="form-control"
              [(ngModel)]="currentEmployee.joinDate" 
              name="employeeJoinDate"
              required>
          </div>
          <div class="form-group">
            <label>Account Number *</label>
            <input 
              type="email" 
              class="form-control"
              [(ngModel)]="currentEmployee.accountNumber" 
              name="employeeEmail"
              placeholder="Enter Account Number"
              required>
          </div>
          <div class="form-group">
            <label>IFSC Code *</label>
            <input 
              type="email" 
              class="form-control"
              [(ngModel)]="currentEmployee.ifscCode" 
              name="employeeEmail"
              placeholder="Enter IFSC Code"
              required>
          </div>
        </form>
      </div>
      <div class="modal-footer-css">
        <button class="btn-secondary" type="button" (click)="closeEmployeeModal()">Cancel</button>
        <button class="btn-primary" type="button" (click)="saveEmployee()">
          {{ isEditMode ? 'Update' : 'Add' }} Employee
        </button>
      </div>
    </div>
  </div>
  
  <!-- Beneficiary Modal -->
  <div class="modal-overlay-css" *ngIf="showBeneficiaryModal" (click)="closeBeneficiaryModal()">
    <div class="modal-css" (click)="$event.stopPropagation()">
      <div class="modal-header-css">
        <h2>{{ isEditMode ? 'Edit Beneficiary' : 'Add New Beneficiary' }}</h2>
        <button class="close-btn" (click)="closeBeneficiaryModal()">×</button>
      </div>
      <div class="modal-body-css">
        <form>
          <div class="form-group">
            <label>Name *</label>
            <input 
              type="text" 
              class="form-control"
              [(ngModel)]="currentBeneficiary.name" 
              name="beneficiaryName"
              placeholder="Enter beneficiary name"
              required>
          </div>
          <div class="form-group">
            <label>Account Number *</label>
            <input 
              type="text" 
              class="form-control"
              [(ngModel)]="currentBeneficiary.accountNumber" 
              name="beneficiaryAccount"
              placeholder="Enter account number"
              required>
          </div>
          <div class="form-group">
            <label>IFSC Code *</label>
            <input 
              type="text" 
              class="form-control"
              [(ngModel)]="currentBeneficiary.ifscCode" 
              name="beneficiaryIFSC"
              placeholder="Enter IFSC code"
              required>
          </div>
          <div class="form-group">
            <label>Bank Name *</label>
            <input 
              type="text" 
              class="form-control"
              [(ngModel)]="currentBeneficiary.bankName" 
              name="beneficiaryBank"
              placeholder="Enter bank name"
              required>
          </div>
          <div class="form-group">
            <label>Relationship *</label>
            <input 
              type="text" 
              class="form-control"
              [(ngModel)]="currentBeneficiary.relationShip" 
              name="beneficiaryRelationship"
              placeholder="e.g., Vendor, Supplier, Contractor">
          </div>
        </form>
      </div>
      <div class="modal-footer-css">
        <button class="btn-secondary" type="button" (click)="closeBeneficiaryModal()">Cancel</button>
        <button class="btn-primary" type="button" (click)="saveBeneficiary()">
          {{ isEditMode ? 'Update' : 'Add' }} Beneficiary
        </button>
      </div>
    </div>
  </div>
  
  <!-- Payment Modal -->
  <div class="modal-overlay-css" *ngIf="showPaymentModal" (click)="closePaymentModal()">
    <div class="modal-css" (click)="$event.stopPropagation()">
      <div class="modal-header-css">
        <h2>Make Payment</h2>
        <button class="close-btn" (click)="closePaymentModal()">×</button>
      </div>
      <div class="modal-body-css">
        <div class="balance-info">
          <span>Available Balance:</span>
          <strong>₹{{ bankDetails.balance | number:'1.2-2' }}</strong>
        </div>
        
        <form>
          <div class="form-group">
            <label>Select Beneficiary *</label>
            <select 
              class="form-control"
              [(ngModel)]="selectedBeneficiaryId" 
              name="beneficiarySelect"
              required>
              <option [value]="0" disabled>-- Select Beneficiary --</option>
              <option *ngFor="let beneficiary of beneficiaries" [value]="beneficiary.beneficiaryId">
                {{ beneficiary.name }} ({{ beneficiary.bankName }})
              </option>
            </select>
          </div>
          
          <div class="form-group" *ngIf="selectedBeneficiaryId > 0 && getSelectedBeneficiary()">
            <label>Beneficiary Details</label>
            <div class="beneficiary-info">
              <p><strong>Account:</strong> {{ getSelectedBeneficiary()?.accountNumber }}</p>
              <p><strong>IFSC:</strong> {{ getSelectedBeneficiary()?.ifscCode }}</p>
              <p><strong>Bank:</strong> {{ getSelectedBeneficiary()?.bankName }}</p>
            </div>
          </div>
          
          <div class="form-group">
            <label>Amount *</label>
            <input 
              type="number" 
              class="form-control"
              [(ngModel)]="currentPayment.amount" 
              name="paymentAmount"
              placeholder="Enter amount" 
              min="1" 
              required>
          </div>
          
          <div class="form-group">
            <label>Payment Date *</label>
            <input 
              type="date" 
              class="form-control"
              [(ngModel)]="currentPayment.paymentDate" 
              name="paymentDate"
              required>
          </div>
          
          <div class="form-group">
            <label>Remarks</label>
            <textarea 
              class="form-control"
              [(ngModel)]="currentPayment.remarks" 
              name="paymentRemarks"
              rows="3" 
              placeholder="Enter payment purpose or remarks"></textarea>
          </div>
        </form>
      </div>
      <div class="modal-footer-css">
        <button class="btn-secondary" type="button" (click)="closePaymentModal()">Cancel</button>
        <button class="btn-primary" type="button" (click)="makePayment()">
          Process Payment
        </button>
      </div>
    </div>
  </div>
</div>